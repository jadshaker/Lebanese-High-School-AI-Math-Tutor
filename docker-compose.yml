services:
  # API Gateway - Main entry point
  gateway:
    build:
      context: services/gateway
      dockerfile: Dockerfile
    container_name: math-tutor-gateway
    ports:
      - '8000:8000'
    env_file:
      - .env
    environment:
      - LARGE_LLM_SERVICE_URL=http://large-llm:8001
    command: uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
    depends_on:
      - large-llm
    networks:
      - math-tutor-network

  # Large LLM Service
  large-llm:
    build:
      context: services/large_llm
      dockerfile: Dockerfile
    container_name: math-tutor-large-llm
    ports:
      - '8001:8001'
    env_file:
      - .env
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
    command: uvicorn src.main:app --host 0.0.0.0 --port 8001 --reload
    networks:
      - math-tutor-network

networks:
  math-tutor-network:
    driver: bridge
